services:
  challtestsrv:
    image: ghcr.io/letsencrypt/pebble-challtestsrv:latest
    command:
      - -defaultIPv6=
      - -defaultIPv4=10.77.77.2
      - -doh=
    networks:
      acmenet:
        ipv4_address: 10.77.77.2
    ports:
      - "18055:8055"   # Management API (host-accessible)

  pebble:
    image: ghcr.io/letsencrypt/pebble:latest
    command:
      - -config=/etc/pebble/pebble-config.json
      - -dnsserver=10.77.77.2:8053
    environment:
      PEBBLE_VA_NOSLEEP: 1
      PEBBLE_VA_ALWAYS_VALID: 0
    volumes:
      - ./pebble-config.json:/etc/pebble/pebble-config.json:ro
    ports:
      - "15000:14000"  # ACME directory (HTTPS)
      - "15002:15000"  # Management/root cert endpoint
    networks:
      acmenet:
        ipv4_address: 10.77.77.3
    depends_on:
      - challtestsrv

networks:
  acmenet:
    driver: bridge
    ipam:
      config:
        - subnet: 10.77.77.0/24
